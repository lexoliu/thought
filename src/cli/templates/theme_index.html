<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="{{ asset_prefix }}assets/style.css">
    <title>{{ entries | length }} articles</title>
  </head>
  <body>
    <h1>{{ entries | length }} article(s)</h1>
    <div style="position: relative; margin: 12px 0;">
      <input id="search-input" type="search" placeholder="Searchâ€¦" style="width: 100%; padding: 10px 90px 10px 10px;">
      <button id="search-btn" style="position:absolute; right:8px; top:50%; transform: translateY(-50%);">Search</button>
    </div>
    <div id="search-results"></div>
    <ul>
    {% for entry in entries %}
      <li><a href="{{ entry.href }}">{{ entry.title }}</a></li>
    {% endfor %}
    {% if entries | length == 0 %}
      <li>No content yet.</li>
    {% endif %}
    </ul>
    <script src="{{ search_js }}" defer></script>
    <script>
      const input = document.getElementById('search-input');
      const button = document.getElementById('search-btn');
      const results = document.getElementById('search-results');
      function renderResults(hits) {
        if (!hits || hits.length === 0) {
          results.innerHTML = '';
          return;
        }
        results.innerHTML = hits.map(hit => `<div><a href="${hit.permalink}">${hit.title}</a></div>`).join('');
      }
      function preferredLocale() {
        const htmlLocale = document.documentElement.lang?.trim();
        if (htmlLocale) {
          return htmlLocale;
        }
        return navigator.language || '';
      }
      async function runSearch() {
        const query = input.value.trim();
        if (!query) { results.innerHTML = ''; return; }
        const res = await window.ThoughtSearch.search(query, preferredLocale());
        const hits = Array.isArray(res) ? res : (res && res.hits) ? res.hits : [];
        renderResults(hits);
      }
      button?.addEventListener('click', runSearch);
      input?.addEventListener('keydown', (e) => { if (e.key === 'Enter') runSearch(); });
    </script>
  </body>
</html>
